<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OMNEST Simulation Library: statemap.h Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c1f96c663b8c6b82e9251148af4abcd0.html">include</a>
  </div>
</div>
<div class="contents">
<h1>statemap.h</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#ifndef _H_STATEMAP</span>
<a name="l00002"></a>00002 <span class="preprocessor"></span><span class="preprocessor">#define _H_STATEMAP</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// The contents of this file are subject to the Mozilla Public</span>
<a name="l00006"></a>00006 <span class="comment">// License Version 1.1 (the &quot;License&quot;); you may not use this file</span>
<a name="l00007"></a>00007 <span class="comment">// except in compliance with the License. You may obtain a copy</span>
<a name="l00008"></a>00008 <span class="comment">// of the License at http://www.mozilla.org/MPL/</span>
<a name="l00009"></a>00009 <span class="comment">//</span>
<a name="l00010"></a>00010 <span class="comment">// Software distributed under the License is distributed on an</span>
<a name="l00011"></a>00011 <span class="comment">// &quot;AS IS&quot; basis, WITHOUT WARRANTY OF ANY KIND, either express or</span>
<a name="l00012"></a>00012 <span class="comment">// implied. See the License for the specific language governing</span>
<a name="l00013"></a>00013 <span class="comment">// rights and limitations under the License.</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">// The Original Code is State Machine Compiler (SMC).</span>
<a name="l00016"></a>00016 <span class="comment">//</span>
<a name="l00017"></a>00017 <span class="comment">// The Initial Developer of the Original Code is Charles W. Rapp.</span>
<a name="l00018"></a>00018 <span class="comment">// Portions created by Charles W. Rapp are</span>
<a name="l00019"></a>00019 <span class="comment">// Copyright (C) 2000 - 2007. Charles W. Rapp.</span>
<a name="l00020"></a>00020 <span class="comment">// All Rights Reserved.</span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="comment">// Contributor(s):</span>
<a name="l00023"></a>00023 <span class="comment">//</span>
<a name="l00024"></a>00024 <span class="comment">// Namespace</span>
<a name="l00025"></a>00025 <span class="comment">//      statemap</span>
<a name="l00026"></a>00026 <span class="comment">//</span>
<a name="l00027"></a>00027 <span class="comment">// Description</span>
<a name="l00028"></a>00028 <span class="comment">//  This namespace contains the finite state machine context</span>
<a name="l00029"></a>00029 <span class="comment">//  class. The user can derive FSM contexts from this class and</span>
<a name="l00030"></a>00030 <span class="comment">//  interface to them with the methods of this class.</span>
<a name="l00031"></a>00031 <span class="comment">//</span>
<a name="l00032"></a>00032 <span class="comment">// Notes</span>
<a name="l00033"></a>00033 <span class="comment">//  The finite state machine needs to be initialized to the</span>
<a name="l00034"></a>00034 <span class="comment">//  starting state of the FSM.  This must be done manually in</span>
<a name="l00035"></a>00035 <span class="comment">//  the constructor of the derived class.</span>
<a name="l00036"></a>00036 <span class="comment">//</span>
<a name="l00037"></a>00037 <span class="comment">// Author</span>
<a name="l00038"></a>00038 <span class="comment">//      C. W. Rapp</span>
<a name="l00039"></a>00039 <span class="comment">//</span>
<a name="l00040"></a>00040 <span class="comment">// RCS ID</span>
<a name="l00041"></a>00041 <span class="comment">// $Id: statemap.h,v 1.17 2011/11/20 14:58:32 cwrapp Exp $</span>
<a name="l00042"></a>00042 <span class="comment">//</span>
<a name="l00043"></a>00043 <span class="comment">// CHANGE LOG</span>
<a name="l00044"></a>00044 <span class="comment">// (See bottom of file)</span>
<a name="l00045"></a>00045 <span class="comment">//</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="preprocessor">#if (__GNUC__ &gt; 3 || (__GNUC__ == 3 &amp;&amp; __GNUC_MINOR__ &gt;= 1))</span>
<a name="l00048"></a>00048 <span class="preprocessor"></span><span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#if defined(SMC_NO_EXCEPTIONS)</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#endif // SMC_NO_EXCEPTIONS</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span><span class="preprocessor">#include &lt;cstdio&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#elif defined(WIN32)</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;windows.h&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#if defined(SMC_NO_EXCEPTIONS)</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#endif // SMC_NO_EXCEPTIONS</span>
<a name="l00059"></a>00059 <span class="preprocessor"></span><span class="preprocessor">#else</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#include &lt;iostream.h&gt;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#if defined(SMC_NO_EXCEPTIONS)</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#endif // SMC_NO_EXCEPTIONS</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#endif</span>
<a name="l00066"></a>00066 <span class="preprocessor"></span><span class="preprocessor">#if ! defined(SMC_NO_EXCEPTIONS)</span>
<a name="l00067"></a>00067 <span class="preprocessor"></span><span class="preprocessor">#include &lt;stdexcept&gt;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &lt;cstring&gt;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#endif</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>
<a name="l00071"></a>00071 <span class="comment">// Limit names to 100 ASCII characters.</span>
<a name="l00072"></a>00072 <span class="comment">// Why 100? Because it is a round number.</span>
<a name="l00073"></a>00073 <span class="preprocessor">#define MAX_NAME_LEN 100</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span>
<a name="l00075"></a>00075 <span class="keyword">namespace </span>statemap
<a name="l00076"></a>00076 {
<a name="l00077"></a>00077 <span class="comment">//---------------------------------------------------------------</span>
<a name="l00078"></a>00078 <span class="comment">// Routines.</span>
<a name="l00079"></a>00079 <span class="comment">//</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081     <span class="keyword">inline</span> <span class="keywordtype">char</span>* copyString(<span class="keyword">const</span> <span class="keywordtype">char</span> *s)
<a name="l00082"></a>00082     {
<a name="l00083"></a>00083         <span class="keywordtype">char</span> *retval = NULL;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="keywordflow">if</span> (s != NULL)
<a name="l00086"></a>00086         {
<a name="l00087"></a>00087             retval = <span class="keyword">new</span> <span class="keywordtype">char</span>[MAX_NAME_LEN + 1];
<a name="l00088"></a>00088             retval[MAX_NAME_LEN] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00089"></a>00089             (void) std::strncpy(retval, s, MAX_NAME_LEN);
<a name="l00090"></a>00090         }
<a name="l00091"></a>00091 
<a name="l00092"></a>00092         <span class="keywordflow">return</span> (retval);
<a name="l00093"></a>00093     }
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">//---------------------------------------------------------------</span>
<a name="l00096"></a>00096 <span class="comment">// Exception Classes.</span>
<a name="l00097"></a>00097 <span class="comment">//</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="preprocessor">#ifndef SMC_NO_EXCEPTIONS</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>    <span class="comment">// Base class for all SMC exceptions.</span>
<a name="l00101"></a>00101     <span class="keyword">class </span>SmcException :
<a name="l00102"></a>00102         <span class="keyword">public</span> std::runtime_error
<a name="l00103"></a>00103     {
<a name="l00104"></a>00104     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00105"></a>00105     <span class="comment">// Member methods</span>
<a name="l00106"></a>00106     <span class="comment">//</span>
<a name="l00107"></a>00107     <span class="keyword">public</span>:
<a name="l00108"></a>00108 
<a name="l00109"></a>00109         <span class="comment">// Destructor.</span>
<a name="l00110"></a>00110         <span class="keyword">virtual</span> ~SmcException() throw()
<a name="l00111"></a>00111         {};
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="keyword">protected</span>:
<a name="l00114"></a>00114 
<a name="l00115"></a>00115         <span class="comment">// Constructor.</span>
<a name="l00116"></a>00116         SmcException(<span class="keyword">const</span> std::string&amp; reason)
<a name="l00117"></a>00117         : std::runtime_error(reason)
<a name="l00118"></a>00118         {};
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <span class="keyword">private</span>:
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         <span class="comment">// Default construction not allowed.</span>
<a name="l00123"></a>00123         SmcException();
<a name="l00124"></a>00124 
<a name="l00125"></a>00125     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00126"></a>00126     <span class="comment">// Member data.</span>
<a name="l00127"></a>00127     <span class="comment">//</span>
<a name="l00128"></a>00128     <span class="keyword">public</span>:
<a name="l00129"></a>00129     <span class="keyword">protected</span>:
<a name="l00130"></a>00130     <span class="keyword">private</span>:
<a name="l00131"></a>00131     };
<a name="l00132"></a>00132 
<a name="l00133"></a>00133     <span class="comment">// This class is thrown when a pop is issued on an empty</span>
<a name="l00134"></a>00134     <span class="comment">// state stack.</span>
<a name="l00135"></a>00135     <span class="keyword">class </span>PopOnEmptyStateStackException :
<a name="l00136"></a>00136         <span class="keyword">public</span> SmcException
<a name="l00137"></a>00137     {
<a name="l00138"></a>00138     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00139"></a>00139     <span class="comment">// Member methods.</span>
<a name="l00140"></a>00140     <span class="comment">//</span>
<a name="l00141"></a>00141     <span class="keyword">public</span>:
<a name="l00142"></a>00142 
<a name="l00143"></a>00143         <span class="comment">// Default constructor.</span>
<a name="l00144"></a>00144         PopOnEmptyStateStackException()
<a name="l00145"></a>00145         : SmcException(<span class="stringliteral">&quot;no state to pop from state stack&quot;</span>)
<a name="l00146"></a>00146         {};
<a name="l00147"></a>00147 
<a name="l00148"></a>00148         <span class="comment">// Destructor.</span>
<a name="l00149"></a>00149         <span class="keyword">virtual</span> ~PopOnEmptyStateStackException() throw()
<a name="l00150"></a>00150         {};
<a name="l00151"></a>00151 
<a name="l00152"></a>00152     <span class="keyword">protected</span>:
<a name="l00153"></a>00153     <span class="keyword">private</span>:
<a name="l00154"></a>00154 
<a name="l00155"></a>00155     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00156"></a>00156     <span class="comment">// Member data.</span>
<a name="l00157"></a>00157     <span class="comment">//</span>
<a name="l00158"></a>00158     <span class="keyword">public</span>:
<a name="l00159"></a>00159     <span class="keyword">protected</span>:
<a name="l00160"></a>00160     <span class="keyword">private</span>:
<a name="l00161"></a>00161     };
<a name="l00162"></a>00162 
<a name="l00163"></a>00163     <span class="comment">// This class is thrown when a transition is issued</span>
<a name="l00164"></a>00164     <span class="comment">// but there is no current state. This happens when</span>
<a name="l00165"></a>00165     <span class="comment">// a transition is issued from within a transition</span>
<a name="l00166"></a>00166     <span class="comment">// action.</span>
<a name="l00167"></a>00167     <span class="keyword">class </span>StateUndefinedException :
<a name="l00168"></a>00168         <span class="keyword">public</span> SmcException
<a name="l00169"></a>00169     {
<a name="l00170"></a>00170     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00171"></a>00171     <span class="comment">// Member methods.</span>
<a name="l00172"></a>00172     <span class="comment">//</span>
<a name="l00173"></a>00173     <span class="keyword">public</span>:
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <span class="comment">// Default constructor.</span>
<a name="l00176"></a>00176         StateUndefinedException()
<a name="l00177"></a>00177         : SmcException(<span class="stringliteral">&quot;transition invoked while in transition&quot;</span>)
<a name="l00178"></a>00178         {};
<a name="l00179"></a>00179 
<a name="l00180"></a>00180         <span class="comment">// Destructor.</span>
<a name="l00181"></a>00181         <span class="keyword">virtual</span> ~StateUndefinedException() throw()
<a name="l00182"></a>00182         {};
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="keyword">protected</span>:
<a name="l00185"></a>00185     <span class="keyword">private</span>:
<a name="l00186"></a>00186 
<a name="l00187"></a>00187     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00188"></a>00188     <span class="comment">// Member data.</span>
<a name="l00189"></a>00189     <span class="comment">//</span>
<a name="l00190"></a>00190     <span class="keyword">public</span>:
<a name="l00191"></a>00191     <span class="keyword">protected</span>:
<a name="l00192"></a>00192     <span class="keyword">private</span>:
<a name="l00193"></a>00193     };
<a name="l00194"></a>00194 
<a name="l00195"></a>00195     <span class="comment">// This class is thrown when a transition is issued</span>
<a name="l00196"></a>00196     <span class="comment">// but there is no code to handle it.</span>
<a name="l00197"></a>00197     <span class="keyword">class </span>TransitionUndefinedException :
<a name="l00198"></a>00198         <span class="keyword">public</span> SmcException
<a name="l00199"></a>00199     {
<a name="l00200"></a>00200     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00201"></a>00201     <span class="comment">// Member methods.</span>
<a name="l00202"></a>00202     <span class="comment">//</span>
<a name="l00203"></a>00203     <span class="keyword">public</span>:
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <span class="comment">// Default constructor.</span>
<a name="l00206"></a>00206         TransitionUndefinedException()
<a name="l00207"></a>00207         : SmcException(<span class="stringliteral">&quot;no such transition in current state&quot;</span>),
<a name="l00208"></a>00208           _state(NULL),
<a name="l00209"></a>00209           _transition(NULL)
<a name="l00210"></a>00210         {};
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         <span class="comment">// Construct an exception using the specified state</span>
<a name="l00213"></a>00213         <span class="comment">// and transition.</span>
<a name="l00214"></a>00214         TransitionUndefinedException(<span class="keyword">const</span> <span class="keywordtype">char</span> *state,
<a name="l00215"></a>00215                                      <span class="keyword">const</span> <span class="keywordtype">char</span> *transition)
<a name="l00216"></a>00216         : SmcException(<span class="stringliteral">&quot;no such transition in current state&quot;</span>),
<a name="l00217"></a>00217           _state(copyString(state)),
<a name="l00218"></a>00218           _transition(copyString(transition))
<a name="l00219"></a>00219         {};
<a name="l00220"></a>00220 
<a name="l00221"></a>00221         <span class="comment">// Copy constructor.</span>
<a name="l00222"></a>00222         TransitionUndefinedException(
<a name="l00223"></a>00223             <span class="keyword">const</span> TransitionUndefinedException&amp; ex)
<a name="l00224"></a>00224         : SmcException(<span class="stringliteral">&quot;no such transition in current state&quot;</span>),
<a name="l00225"></a>00225           _state(copyString(ex._state)),
<a name="l00226"></a>00226           _transition(copyString(ex._transition))
<a name="l00227"></a>00227         {};
<a name="l00228"></a>00228 
<a name="l00229"></a>00229         <span class="comment">// Destructor.</span>
<a name="l00230"></a>00230         <span class="keyword">virtual</span> ~TransitionUndefinedException() throw()
<a name="l00231"></a>00231         {
<a name="l00232"></a>00232             <span class="keywordflow">if</span> (_state != NULL)
<a name="l00233"></a>00233             {
<a name="l00234"></a>00234                 <span class="keyword">delete</span>[] _state;
<a name="l00235"></a>00235                 _state = NULL;
<a name="l00236"></a>00236             }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238             <span class="keywordflow">if</span> (_transition != NULL)
<a name="l00239"></a>00239             {
<a name="l00240"></a>00240                 <span class="keyword">delete</span>[] _transition;
<a name="l00241"></a>00241                 _transition = NULL;
<a name="l00242"></a>00242             }
<a name="l00243"></a>00243         };
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         <span class="comment">// Assignment operator.</span>
<a name="l00246"></a>00246         <span class="keyword">const</span> TransitionUndefinedException&amp;
<a name="l00247"></a>00247             operator=(<span class="keyword">const</span> TransitionUndefinedException&amp; ex)
<a name="l00248"></a>00248         {
<a name="l00249"></a>00249             <span class="comment">// Don&#39;t do self assignment.</span>
<a name="l00250"></a>00250             <span class="keywordflow">if</span> (<span class="keyword">this</span> != &amp;ex)
<a name="l00251"></a>00251             {
<a name="l00252"></a>00252                 <span class="keywordflow">if</span> (_state != NULL)
<a name="l00253"></a>00253                 {
<a name="l00254"></a>00254                     <span class="keyword">delete</span>[] _state;
<a name="l00255"></a>00255                     _state = NULL;
<a name="l00256"></a>00256                 }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258                 <span class="keywordflow">if</span> (_transition != NULL)
<a name="l00259"></a>00259                 {
<a name="l00260"></a>00260                     <span class="keyword">delete</span>[] _transition;
<a name="l00261"></a>00261                     _transition = NULL;
<a name="l00262"></a>00262                 }
<a name="l00263"></a>00263 
<a name="l00264"></a>00264                 _state = copyString(ex._state);
<a name="l00265"></a>00265                 _transition = copyString(ex._transition);
<a name="l00266"></a>00266             }
<a name="l00267"></a>00267 
<a name="l00268"></a>00268             <span class="keywordflow">return</span> (*<span class="keyword">this</span>);
<a name="l00269"></a>00269         };
<a name="l00270"></a>00270 
<a name="l00271"></a>00271         <span class="comment">// Returns the state. May be NULL.</span>
<a name="l00272"></a>00272         <span class="keyword">const</span> <span class="keywordtype">char</span>* getState()<span class="keyword"> const</span>
<a name="l00273"></a>00273 <span class="keyword">        </span>{
<a name="l00274"></a>00274             <span class="keywordflow">return</span>(_state);
<a name="l00275"></a>00275         };
<a name="l00276"></a>00276 
<a name="l00277"></a>00277         <span class="comment">// Returns the transition. May be NULL.</span>
<a name="l00278"></a>00278         <span class="keyword">const</span> <span class="keywordtype">char</span>* getTransition()<span class="keyword"> const</span>
<a name="l00279"></a>00279 <span class="keyword">        </span>{
<a name="l00280"></a>00280             <span class="keywordflow">return</span> (_transition);
<a name="l00281"></a>00281         };
<a name="l00282"></a>00282 
<a name="l00283"></a>00283     <span class="keyword">protected</span>:
<a name="l00284"></a>00284     <span class="keyword">private</span>:
<a name="l00285"></a>00285 
<a name="l00286"></a>00286     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00287"></a>00287     <span class="comment">// Member data.</span>
<a name="l00288"></a>00288     <span class="comment">//</span>
<a name="l00289"></a>00289     <span class="keyword">public</span>:
<a name="l00290"></a>00290     <span class="keyword">protected</span>:
<a name="l00291"></a>00291     <span class="keyword">private</span>:
<a name="l00292"></a>00292 
<a name="l00293"></a>00293                 <span class="keywordtype">char</span> *_state;
<a name="l00294"></a>00294                 <span class="keywordtype">char</span> *_transition;
<a name="l00295"></a>00295     };
<a name="l00296"></a>00296 
<a name="l00297"></a>00297     <span class="comment">// This class is thrown when a state ID is either less than</span>
<a name="l00298"></a>00298     <span class="comment">// the minimal value or greater than the maximal value.</span>
<a name="l00299"></a>00299     <span class="keyword">class </span>IndexOutOfBoundsException :
<a name="l00300"></a>00300         <span class="keyword">public</span> SmcException
<a name="l00301"></a>00301     {
<a name="l00302"></a>00302     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00303"></a>00303     <span class="comment">// Member methods.</span>
<a name="l00304"></a>00304     <span class="comment">//</span>
<a name="l00305"></a>00305     <span class="keyword">public</span>:
<a name="l00306"></a>00306 
<a name="l00307"></a>00307         <span class="comment">// Default constructor.</span>
<a name="l00308"></a>00308         IndexOutOfBoundsException()
<a name="l00309"></a>00309         : SmcException(<span class="stringliteral">&quot;index out of bounds&quot;</span>),
<a name="l00310"></a>00310           _index(0),
<a name="l00311"></a>00311           _minIndex(0),
<a name="l00312"></a>00312           _maxIndex(0)
<a name="l00313"></a>00313         {};
<a name="l00314"></a>00314 
<a name="l00315"></a>00315         <span class="comment">// Constructs an exception using the specified index,</span>
<a name="l00316"></a>00316         <span class="comment">// minimum index and maximum index.</span>
<a name="l00317"></a>00317         IndexOutOfBoundsException(<span class="keyword">const</span> <span class="keywordtype">int</span> index,
<a name="l00318"></a>00318                                   <span class="keyword">const</span> <span class="keywordtype">int</span> minIndex,
<a name="l00319"></a>00319                                   <span class="keyword">const</span> <span class="keywordtype">int</span> maxIndex)
<a name="l00320"></a>00320         : SmcException(<span class="stringliteral">&quot;index out of bounds&quot;</span>),
<a name="l00321"></a>00321           _index(index),
<a name="l00322"></a>00322           _minIndex(minIndex),
<a name="l00323"></a>00323           _maxIndex(maxIndex)
<a name="l00324"></a>00324         {};
<a name="l00325"></a>00325 
<a name="l00326"></a>00326         <span class="comment">// Copy constructor.</span>
<a name="l00327"></a>00327         IndexOutOfBoundsException(
<a name="l00328"></a>00328             <span class="keyword">const</span> IndexOutOfBoundsException&amp; ex)
<a name="l00329"></a>00329         : SmcException(<span class="stringliteral">&quot;index out of bounds&quot;</span>),
<a name="l00330"></a>00330           _index(ex._index),
<a name="l00331"></a>00331           _minIndex(ex._minIndex),
<a name="l00332"></a>00332           _maxIndex(ex._maxIndex)
<a name="l00333"></a>00333         {};
<a name="l00334"></a>00334 
<a name="l00335"></a>00335         <span class="comment">// Destructor.</span>
<a name="l00336"></a>00336         <span class="keyword">virtual</span> ~IndexOutOfBoundsException() throw()
<a name="l00337"></a>00337         {};
<a name="l00338"></a>00338 
<a name="l00339"></a>00339         <span class="comment">// Assignment operator.</span>
<a name="l00340"></a>00340         <span class="keyword">const</span> IndexOutOfBoundsException&amp;
<a name="l00341"></a>00341             operator=(<span class="keyword">const</span> IndexOutOfBoundsException&amp; ex)
<a name="l00342"></a>00342         {
<a name="l00343"></a>00343             <span class="comment">// Don&#39;t do self assignment.</span>
<a name="l00344"></a>00344             <span class="keywordflow">if</span> (<span class="keyword">this</span> != &amp;ex)
<a name="l00345"></a>00345             {
<a name="l00346"></a>00346                 _index = ex._index;
<a name="l00347"></a>00347                 _minIndex = ex._minIndex;
<a name="l00348"></a>00348                 _maxIndex = ex._maxIndex;
<a name="l00349"></a>00349             }
<a name="l00350"></a>00350 
<a name="l00351"></a>00351             <span class="keywordflow">return</span> (*<span class="keyword">this</span>);
<a name="l00352"></a>00352         };
<a name="l00353"></a>00353 
<a name="l00354"></a>00354         <span class="comment">// Returns the out-of-bounds index.</span>
<a name="l00355"></a>00355         <span class="keywordtype">int</span> getIndex()<span class="keyword"> const</span>
<a name="l00356"></a>00356 <span class="keyword">        </span>{
<a name="l00357"></a>00357             <span class="keywordflow">return</span>(_index);
<a name="l00358"></a>00358         };
<a name="l00359"></a>00359 
<a name="l00360"></a>00360         <span class="comment">// Returns the minimum allowed index value.</span>
<a name="l00361"></a>00361         <span class="keywordtype">int</span> getMinIndex()<span class="keyword"> const</span>
<a name="l00362"></a>00362 <span class="keyword">        </span>{
<a name="l00363"></a>00363             <span class="keywordflow">return</span> (_minIndex);
<a name="l00364"></a>00364         };
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="comment">// Returns the maximum allowed index value.</span>
<a name="l00367"></a>00367         <span class="keywordtype">int</span> getMaxIndex()<span class="keyword"> const</span>
<a name="l00368"></a>00368 <span class="keyword">        </span>{
<a name="l00369"></a>00369             <span class="keywordflow">return</span> (_maxIndex);
<a name="l00370"></a>00370         };
<a name="l00371"></a>00371 
<a name="l00372"></a>00372     <span class="keyword">protected</span>:
<a name="l00373"></a>00373     <span class="keyword">private</span>:
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00376"></a>00376     <span class="comment">// Member data.</span>
<a name="l00377"></a>00377     <span class="comment">//</span>
<a name="l00378"></a>00378     <span class="keyword">public</span>:
<a name="l00379"></a>00379     <span class="keyword">protected</span>:
<a name="l00380"></a>00380     <span class="keyword">private</span>:
<a name="l00381"></a>00381 
<a name="l00382"></a>00382                 <span class="keywordtype">int</span> _index;
<a name="l00383"></a>00383                 <span class="keywordtype">int</span> _minIndex;
<a name="l00384"></a>00384         <span class="keywordtype">int</span> _maxIndex;
<a name="l00385"></a>00385     };
<a name="l00386"></a>00386 <span class="preprocessor">#endif // !SMC_NO_EXCEPTIONS</span>
<a name="l00387"></a>00387 <span class="preprocessor"></span>
<a name="l00388"></a>00388 <span class="comment">//</span>
<a name="l00389"></a>00389 <span class="comment">// end of Exception Classes.</span>
<a name="l00390"></a>00390 <span class="comment">//---------------------------------------------------------------</span>
<a name="l00391"></a>00391 
<a name="l00392"></a>00392     <span class="keyword">class </span>State
<a name="l00393"></a>00393     {
<a name="l00394"></a>00394     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00395"></a>00395     <span class="comment">// Member functions.</span>
<a name="l00396"></a>00396     <span class="comment">//</span>
<a name="l00397"></a>00397     <span class="keyword">public</span>:
<a name="l00398"></a>00398 
<a name="l00399"></a>00399         <span class="keyword">const</span> <span class="keywordtype">char</span>* getName()<span class="keyword"> const</span>
<a name="l00400"></a>00400 <span class="keyword">        </span>{
<a name="l00401"></a>00401             <span class="keywordflow">return</span> (_name);
<a name="l00402"></a>00402         };
<a name="l00403"></a>00403 
<a name="l00404"></a>00404         <span class="keywordtype">int</span> getId()<span class="keyword"> const</span>
<a name="l00405"></a>00405 <span class="keyword">        </span>{
<a name="l00406"></a>00406             <span class="keywordflow">return</span> (_stateId);
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409     <span class="keyword">protected</span>:
<a name="l00410"></a>00410 
<a name="l00411"></a>00411         State(<span class="keyword">const</span> <span class="keywordtype">char</span> *name, <span class="keywordtype">int</span> stateId)
<a name="l00412"></a>00412         : _name(NULL),
<a name="l00413"></a>00413           _stateId(stateId)
<a name="l00414"></a>00414         {
<a name="l00415"></a>00415             <span class="keywordflow">if</span> (name != NULL)
<a name="l00416"></a>00416             {
<a name="l00417"></a>00417                 _name = copyString(name);
<a name="l00418"></a>00418             }
<a name="l00419"></a>00419             <span class="keywordflow">else</span>
<a name="l00420"></a>00420             {
<a name="l00421"></a>00421                 _name = copyString(<span class="stringliteral">&quot;NAME NOT SET&quot;</span>);
<a name="l00422"></a>00422             }
<a name="l00423"></a>00423         };
<a name="l00424"></a>00424 
<a name="l00425"></a>00425         <span class="keyword">virtual</span> ~State()
<a name="l00426"></a>00426         {
<a name="l00427"></a>00427             <span class="keywordflow">if</span> (_name != NULL)
<a name="l00428"></a>00428             {
<a name="l00429"></a>00429                 <span class="keyword">delete</span>[] _name;
<a name="l00430"></a>00430                 _name = NULL;
<a name="l00431"></a>00431             }
<a name="l00432"></a>00432         };
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <span class="keyword">private</span>:
<a name="l00435"></a>00435 
<a name="l00436"></a>00436         <span class="comment">// Make the default and copy constructors private to</span>
<a name="l00437"></a>00437         <span class="comment">// prevent their use.</span>
<a name="l00438"></a>00438         State() {};
<a name="l00439"></a>00439         State(<span class="keyword">const</span> State&amp;) {};
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00442"></a>00442     <span class="comment">// Member data.</span>
<a name="l00443"></a>00443     <span class="comment">//</span>
<a name="l00444"></a>00444     <span class="keyword">public</span>:
<a name="l00445"></a>00445     <span class="keyword">protected</span>:
<a name="l00446"></a>00446 
<a name="l00447"></a>00447         <span class="comment">// This state&#39;s printable name.</span>
<a name="l00448"></a>00448         <span class="keywordtype">char</span> *_name;
<a name="l00449"></a>00449 
<a name="l00450"></a>00450         <span class="comment">// This state&#39;s unique identifier.</span>
<a name="l00451"></a>00451         <span class="keywordtype">int</span> _stateId;
<a name="l00452"></a>00452 
<a name="l00453"></a>00453     <span class="keyword">private</span>:
<a name="l00454"></a>00454     };
<a name="l00455"></a>00455 
<a name="l00456"></a>00456     <span class="keyword">class </span>FSMContext
<a name="l00457"></a>00457     {
<a name="l00458"></a>00458     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00459"></a>00459     <span class="comment">// Nested classes.</span>
<a name="l00460"></a>00460     <span class="comment">//</span>
<a name="l00461"></a>00461     <span class="keyword">public</span>:
<a name="l00462"></a>00462     <span class="keyword">protected</span>:
<a name="l00463"></a>00463     <span class="keyword">private</span>:
<a name="l00464"></a>00464 
<a name="l00465"></a>00465         <span class="comment">// Implements the state stack.</span>
<a name="l00466"></a>00466         <span class="keyword">class </span>StateEntry
<a name="l00467"></a>00467         {
<a name="l00468"></a>00468         <span class="comment">//-------------------------------------------------------</span>
<a name="l00469"></a>00469         <span class="comment">// Member functions.</span>
<a name="l00470"></a>00470         <span class="comment">//</span>
<a name="l00471"></a>00471         <span class="keyword">public</span>:
<a name="l00472"></a>00472             StateEntry(State *state, StateEntry *next)
<a name="l00473"></a>00473             : _state(state),
<a name="l00474"></a>00474               _next(next)
<a name="l00475"></a>00475             {};
<a name="l00476"></a>00476 
<a name="l00477"></a>00477             ~StateEntry()
<a name="l00478"></a>00478             {
<a name="l00479"></a>00479                 _state = NULL;
<a name="l00480"></a>00480                 _next = NULL;
<a name="l00481"></a>00481             };
<a name="l00482"></a>00482 
<a name="l00483"></a>00483             State* getState()
<a name="l00484"></a>00484             {
<a name="l00485"></a>00485                 <span class="keywordflow">return</span>(_state);
<a name="l00486"></a>00486             };
<a name="l00487"></a>00487 
<a name="l00488"></a>00488             StateEntry* getNext()
<a name="l00489"></a>00489             {
<a name="l00490"></a>00490                 <span class="keywordflow">return</span>(_next);
<a name="l00491"></a>00491             };
<a name="l00492"></a>00492 
<a name="l00493"></a>00493         <span class="keyword">protected</span>:
<a name="l00494"></a>00494         <span class="keyword">private</span>:
<a name="l00495"></a>00495 
<a name="l00496"></a>00496         <span class="comment">//-------------------------------------------------------</span>
<a name="l00497"></a>00497         <span class="comment">// Member data.</span>
<a name="l00498"></a>00498         <span class="comment">//</span>
<a name="l00499"></a>00499         <span class="keyword">public</span>:
<a name="l00500"></a>00500         <span class="keyword">protected</span>:
<a name="l00501"></a>00501         <span class="keyword">private</span>:
<a name="l00502"></a>00502             State *_state;
<a name="l00503"></a>00503             StateEntry *_next;
<a name="l00504"></a>00504 
<a name="l00505"></a>00505         <span class="comment">//-------------------------------------------------------</span>
<a name="l00506"></a>00506         <span class="comment">// Friends</span>
<a name="l00507"></a>00507         <span class="comment">//</span>
<a name="l00508"></a>00508             <span class="keyword">friend</span> <span class="keyword">class </span>FSMContext;
<a name="l00509"></a>00509         }; <span class="comment">// end of class StateEntry</span>
<a name="l00510"></a>00510 
<a name="l00511"></a>00511     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00512"></a>00512     <span class="comment">// Member functions</span>
<a name="l00513"></a>00513     <span class="comment">//</span>
<a name="l00514"></a>00514     <span class="keyword">public</span>:
<a name="l00515"></a>00515 
<a name="l00516"></a>00516         <span class="comment">// Destructor.</span>
<a name="l00517"></a>00517         <span class="keyword">virtual</span> ~FSMContext()
<a name="l00518"></a>00518         {
<a name="l00519"></a>00519             StateEntry *state;
<a name="l00520"></a>00520 
<a name="l00521"></a>00521             <span class="keywordflow">if</span> (_transition != NULL)
<a name="l00522"></a>00522             {
<a name="l00523"></a>00523                 <span class="keyword">delete</span>[] _transition;
<a name="l00524"></a>00524                 _transition = NULL;
<a name="l00525"></a>00525             }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527             <span class="comment">// But we did allocate the state stack.</span>
<a name="l00528"></a>00528             <span class="keywordflow">while</span> (_state_stack != NULL)
<a name="l00529"></a>00529             {
<a name="l00530"></a>00530                 state = _state_stack;
<a name="l00531"></a>00531                 _state_stack = _state_stack-&gt;_next;
<a name="l00532"></a>00532                 <span class="keyword">delete</span> state;
<a name="l00533"></a>00533             }
<a name="l00534"></a>00534         };
<a name="l00535"></a>00535 
<a name="l00536"></a>00536         <span class="comment">// Comparison and assignment operators</span>
<a name="l00537"></a>00537         <span class="comment">// Assignment operator</span>
<a name="l00538"></a>00538         FSMContext&amp; operator=(<span class="keyword">const</span> FSMContext&amp; fsm)
<a name="l00539"></a>00539         {
<a name="l00540"></a>00540             <span class="comment">// Don&#39;t do the assignment if the left and right</span>
<a name="l00541"></a>00541             <span class="comment">// hand sides are the same object.</span>
<a name="l00542"></a>00542             <span class="keywordflow">if</span> (<span class="keyword">this</span> != &amp;fsm)
<a name="l00543"></a>00543             {
<a name="l00544"></a>00544                 _state = fsm._state;
<a name="l00545"></a>00545             }
<a name="l00546"></a>00546 
<a name="l00547"></a>00547             <span class="keywordflow">return</span>(*<span class="keyword">this</span>);
<a name="l00548"></a>00548         };
<a name="l00549"></a>00549 
<a name="l00550"></a>00550         <span class="comment">// Starts the finite state machine running by executing</span>
<a name="l00551"></a>00551         <span class="comment">// the initial state&#39;s entry actions.</span>
<a name="l00552"></a>00552         <span class="keyword">virtual</span> <span class="keywordtype">void</span> enterStartState()=0;
<a name="l00553"></a>00553 
<a name="l00554"></a>00554         <span class="comment">// Exact same object (is it me?)</span>
<a name="l00555"></a>00555         <span class="keywordtype">int</span> same(<span class="keyword">const</span> FSMContext&amp; fsm)<span class="keyword"> const</span>
<a name="l00556"></a>00556 <span class="keyword">        </span>{
<a name="l00557"></a>00557             <span class="keywordflow">return</span>(<span class="keyword">this</span> == &amp;fsm);
<a name="l00558"></a>00558         };
<a name="l00559"></a>00559 
<a name="l00560"></a>00560         <span class="comment">// Returns the debug flag&#39;s current setting.</span>
<a name="l00561"></a>00561         <span class="keywordtype">bool</span> getDebugFlag()
<a name="l00562"></a>00562         {
<a name="l00563"></a>00563             <span class="keywordflow">return</span>(_debug_flag);
<a name="l00564"></a>00564         };
<a name="l00565"></a>00565 
<a name="l00566"></a>00566         <span class="comment">// Sets the debug flag. A true value means debugging</span>
<a name="l00567"></a>00567         <span class="comment">// is on and false means off.</span>
<a name="l00568"></a>00568         <span class="keywordtype">void</span> setDebugFlag(<span class="keywordtype">bool</span> flag)
<a name="l00569"></a>00569         {
<a name="l00570"></a>00570             _debug_flag = flag;
<a name="l00571"></a>00571             <span class="keywordflow">return</span>;
<a name="l00572"></a>00572         };
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="preprocessor">#ifdef SMC_USES_IOSTREAMS</span>
<a name="l00575"></a>00575 <span class="preprocessor"></span>        <span class="comment">// Returns the stream to which debug output is written.</span>
<a name="l00576"></a>00576         std::ostream&amp; getDebugStream()
<a name="l00577"></a>00577         {
<a name="l00578"></a>00578             <span class="keywordflow">return</span> (*_debug_stream);
<a name="l00579"></a>00579         };
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         <span class="comment">// Sets the debug output stream.</span>
<a name="l00582"></a>00582         <span class="keywordtype">void</span> setDebugStream(std::ostream&amp; debug_stream)
<a name="l00583"></a>00583         {
<a name="l00584"></a>00584             _debug_stream = &amp;debug_stream;
<a name="l00585"></a>00585             <span class="keywordflow">return</span>;
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587 <span class="preprocessor">#endif // SMC_USES_IOSTREAMS</span>
<a name="l00588"></a>00588 <span class="preprocessor"></span>
<a name="l00589"></a>00589         <span class="comment">// Is this state machine already inside a transition?</span>
<a name="l00590"></a>00590         <span class="comment">// Yes if state is null.</span>
<a name="l00591"></a>00591         <span class="keywordtype">bool</span> isInTransition()<span class="keyword"> const</span>
<a name="l00592"></a>00592 <span class="keyword">        </span>{
<a name="l00593"></a>00593             <span class="keywordflow">return</span>(_state == NULL ? <span class="keyword">true</span> : <span class="keyword">false</span>);
<a name="l00594"></a>00594         };
<a name="l00595"></a>00595 
<a name="l00596"></a>00596         <span class="comment">// Returns the current transition&#39;s name.</span>
<a name="l00597"></a>00597         <span class="comment">// Used only for debugging purposes.</span>
<a name="l00598"></a>00598         <span class="keywordtype">char</span>* getTransition()
<a name="l00599"></a>00599         {
<a name="l00600"></a>00600             <span class="keywordflow">return</span> (_transition);
<a name="l00601"></a>00601         };
<a name="l00602"></a>00602 
<a name="l00603"></a>00603         <span class="comment">// Saves away the transition name only if debugging</span>
<a name="l00604"></a>00604         <span class="comment">// is turned on.</span>
<a name="l00605"></a>00605         <span class="keywordtype">void</span> setTransition(<span class="keyword">const</span> <span class="keywordtype">char</span> *transition)
<a name="l00606"></a>00606         {
<a name="l00607"></a>00607             <span class="keywordflow">if</span> (_transition != NULL)
<a name="l00608"></a>00608             {
<a name="l00609"></a>00609                 <span class="keyword">delete</span>[] _transition;
<a name="l00610"></a>00610                 _transition = NULL;
<a name="l00611"></a>00611             }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613             _transition = copyString(transition);
<a name="l00614"></a>00614 
<a name="l00615"></a>00615             <span class="keywordflow">return</span>;
<a name="l00616"></a>00616         };
<a name="l00617"></a>00617 
<a name="l00618"></a>00618         <span class="comment">// Clears the current state.</span>
<a name="l00619"></a>00619         <span class="keywordtype">void</span> clearState()
<a name="l00620"></a>00620         {
<a name="l00621"></a>00621             _previous_state = _state;
<a name="l00622"></a>00622             _state = NULL;
<a name="l00623"></a>00623         };
<a name="l00624"></a>00624 
<a name="l00625"></a>00625         <span class="comment">// Returns the state which a transition left.</span>
<a name="l00626"></a>00626         <span class="comment">// May be NULL.</span>
<a name="l00627"></a>00627         State* getPreviousState()
<a name="l00628"></a>00628         {
<a name="l00629"></a>00629             <span class="keywordflow">return</span> (_previous_state);
<a name="l00630"></a>00630         }
<a name="l00631"></a>00631 
<a name="l00632"></a>00632         <span class="comment">// Sets the current state to the specified state.</span>
<a name="l00633"></a>00633         <span class="keywordtype">void</span> setState(<span class="keyword">const</span> State&amp; state)
<a name="l00634"></a>00634         {
<a name="l00635"></a>00635             <span class="comment">// clearState() is not called when a transition has</span>
<a name="l00636"></a>00636             <span class="comment">// no actions, so set _previous_state to _state in</span>
<a name="l00637"></a>00637             <span class="comment">// that situation. We know clearState() was not</span>
<a name="l00638"></a>00638             <span class="comment">// called when _state is not null.</span>
<a name="l00639"></a>00639             <span class="keywordflow">if</span> (_state != NULL)
<a name="l00640"></a>00640             {
<a name="l00641"></a>00641                 _previous_state = _state;
<a name="l00642"></a>00642             }
<a name="l00643"></a>00643 
<a name="l00644"></a>00644             _state = <span class="keyword">const_cast&lt;</span>State *<span class="keyword">&gt;</span>(&amp;state);
<a name="l00645"></a>00645 
<a name="l00646"></a>00646             <span class="keywordflow">if</span> (_debug_flag == <span class="keyword">true</span>)
<a name="l00647"></a>00647             {
<a name="l00648"></a>00648 <span class="preprocessor">#ifdef SMC_USES_IOSTREAMS</span>
<a name="l00649"></a>00649 <span class="preprocessor"></span>                *_debug_stream &lt;&lt; <span class="stringliteral">&quot;ENTER STATE     : &quot;</span>
<a name="l00650"></a>00650                                &lt;&lt; _state-&gt;getName()
<a name="l00651"></a>00651                                &lt;&lt; std::endl;
<a name="l00652"></a>00652 <span class="preprocessor">#else</span>
<a name="l00653"></a>00653 <span class="preprocessor"></span>                TRACE(<span class="stringliteral">&quot;ENTER STATE     : %s\n&quot;</span>,
<a name="l00654"></a>00654                       _state-&gt;getName());
<a name="l00655"></a>00655 <span class="preprocessor">#endif // SMC_USES_IOSTREAMS</span>
<a name="l00656"></a>00656 <span class="preprocessor"></span>            }
<a name="l00657"></a>00657         };
<a name="l00658"></a>00658 
<a name="l00659"></a>00659         <span class="comment">// Returns true if the state stack is empty and false</span>
<a name="l00660"></a>00660         <span class="comment">// otherwise.</span>
<a name="l00661"></a>00661         <span class="keywordtype">bool</span> isStateStackEmpty()<span class="keyword"> const</span>
<a name="l00662"></a>00662 <span class="keyword">        </span>{
<a name="l00663"></a>00663             <span class="keywordflow">return</span> (_state_stack == NULL);
<a name="l00664"></a>00664         }
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         <span class="comment">// Returns the state stack&#39;s depth.</span>
<a name="l00667"></a>00667         <span class="keywordtype">int</span> getStateStackDepth()<span class="keyword"> const</span>
<a name="l00668"></a>00668 <span class="keyword">        </span>{
<a name="l00669"></a>00669             StateEntry *state_ptr;
<a name="l00670"></a>00670             <span class="keywordtype">int</span> retval;
<a name="l00671"></a>00671 
<a name="l00672"></a>00672             <span class="keywordflow">for</span> (state_ptr = _state_stack, retval = 0;
<a name="l00673"></a>00673                  state_ptr != NULL;
<a name="l00674"></a>00674                  state_ptr = state_ptr-&gt;getNext(), ++retval)
<a name="l00675"></a>00675                 ;
<a name="l00676"></a>00676 
<a name="l00677"></a>00677             <span class="keywordflow">return</span> (retval);
<a name="l00678"></a>00678         }
<a name="l00679"></a>00679 
<a name="l00680"></a>00680         <span class="comment">// Push the current state on top of the state stack</span>
<a name="l00681"></a>00681         <span class="comment">// and make the specified state the current state.</span>
<a name="l00682"></a>00682         <span class="keywordtype">void</span> pushState(<span class="keyword">const</span> State&amp; state)
<a name="l00683"></a>00683         {
<a name="l00684"></a>00684             StateEntry *new_entry;
<a name="l00685"></a>00685 
<a name="l00686"></a>00686             <span class="comment">// Do the push only if there is a state to be pushed</span>
<a name="l00687"></a>00687             <span class="comment">// on the stack.</span>
<a name="l00688"></a>00688             <span class="keywordflow">if</span> (_state != NULL)
<a name="l00689"></a>00689             {
<a name="l00690"></a>00690                 new_entry = <span class="keyword">new</span> StateEntry(_state, _state_stack);
<a name="l00691"></a>00691                 _state_stack = new_entry;
<a name="l00692"></a>00692             }
<a name="l00693"></a>00693 
<a name="l00694"></a>00694             _previous_state = _state;
<a name="l00695"></a>00695             _state = <span class="keyword">const_cast&lt;</span>State *<span class="keyword">&gt;</span>(&amp;state);
<a name="l00696"></a>00696 
<a name="l00697"></a>00697             <span class="keywordflow">if</span> (_debug_flag == <span class="keyword">true</span>)
<a name="l00698"></a>00698             {
<a name="l00699"></a>00699 <span class="preprocessor">#ifdef SMC_USES_IOSTREAMS</span>
<a name="l00700"></a>00700 <span class="preprocessor"></span>                *_debug_stream &lt;&lt; <span class="stringliteral">&quot;PUSH TO STATE   : &quot;</span>
<a name="l00701"></a>00701                                &lt;&lt; _state-&gt;getName()
<a name="l00702"></a>00702                                &lt;&lt; std::endl;
<a name="l00703"></a>00703 <span class="preprocessor">#else</span>
<a name="l00704"></a>00704 <span class="preprocessor"></span>                TRACE(<span class="stringliteral">&quot;PUSH TO STATE   : %s\n&quot;</span>,
<a name="l00705"></a>00705                       _state-&gt;getName());
<a name="l00706"></a>00706 <span class="preprocessor">#endif // SMC_USES_IOSTREAMS</span>
<a name="l00707"></a>00707 <span class="preprocessor"></span>            }
<a name="l00708"></a>00708         };
<a name="l00709"></a>00709 
<a name="l00710"></a>00710         <span class="comment">// Make the state on top of the state stack the</span>
<a name="l00711"></a>00711         <span class="comment">// current state.</span>
<a name="l00712"></a>00712         <span class="keywordtype">void</span> popState()
<a name="l00713"></a>00713         {
<a name="l00714"></a>00714             StateEntry *entry;
<a name="l00715"></a>00715 
<a name="l00716"></a>00716             <span class="comment">// Popping when there was no previous push is an error.</span>
<a name="l00717"></a>00717 <span class="preprocessor">#ifdef SMC_NO_EXCEPTIONS</span>
<a name="l00718"></a>00718 <span class="preprocessor"></span>            assert(_state_stack != NULL);
<a name="l00719"></a>00719 <span class="preprocessor">#else</span>
<a name="l00720"></a>00720 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (_state_stack == NULL)
<a name="l00721"></a>00721             {
<a name="l00722"></a>00722                 <span class="keywordflow">throw</span> PopOnEmptyStateStackException();
<a name="l00723"></a>00723             }
<a name="l00724"></a>00724 <span class="preprocessor">#endif // SMC_NO_EXCEPTIONS</span>
<a name="l00725"></a>00725 <span class="preprocessor"></span>
<a name="l00726"></a>00726             _previous_state = _state;
<a name="l00727"></a>00727             _state = _state_stack-&gt;getState();
<a name="l00728"></a>00728             entry = _state_stack;
<a name="l00729"></a>00729             _state_stack = _state_stack-&gt;getNext();
<a name="l00730"></a>00730             <span class="keyword">delete</span> entry;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732             <span class="keywordflow">if</span> (_debug_flag == <span class="keyword">true</span>)
<a name="l00733"></a>00733             {
<a name="l00734"></a>00734 <span class="preprocessor">#ifdef SMC_USES_IOSTREAMS</span>
<a name="l00735"></a>00735 <span class="preprocessor"></span>                *_debug_stream &lt;&lt; <span class="stringliteral">&quot;POP TO STATE    : &quot;</span>
<a name="l00736"></a>00736                                &lt;&lt; _state-&gt;getName()
<a name="l00737"></a>00737                                &lt;&lt; std::endl;
<a name="l00738"></a>00738 <span class="preprocessor">#else</span>
<a name="l00739"></a>00739 <span class="preprocessor"></span>                TRACE(<span class="stringliteral">&quot;POP TO STATE    : %s\n&quot;</span>,
<a name="l00740"></a>00740                       _state-&gt;getName());
<a name="l00741"></a>00741 <span class="preprocessor">#endif // SMC_USES_IOSTREAMS</span>
<a name="l00742"></a>00742 <span class="preprocessor"></span>            }
<a name="l00743"></a>00743         };
<a name="l00744"></a>00744 
<a name="l00745"></a>00745         <span class="comment">// Remove all states from the state stack.</span>
<a name="l00746"></a>00746         <span class="keywordtype">void</span> emptyStateStack()
<a name="l00747"></a>00747         {
<a name="l00748"></a>00748             StateEntry *state_ptr,
<a name="l00749"></a>00749                        *next_ptr;
<a name="l00750"></a>00750 
<a name="l00751"></a>00751             <span class="keywordflow">for</span> (state_ptr = _state_stack;
<a name="l00752"></a>00752                  state_ptr != NULL;
<a name="l00753"></a>00753                  state_ptr = next_ptr)
<a name="l00754"></a>00754             {
<a name="l00755"></a>00755                 next_ptr = state_ptr-&gt;getNext();
<a name="l00756"></a>00756                 <span class="keyword">delete</span> state_ptr;
<a name="l00757"></a>00757             }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759             _state_stack = NULL;
<a name="l00760"></a>00760         };
<a name="l00761"></a>00761 
<a name="l00762"></a>00762     <span class="keyword">protected</span>:
<a name="l00763"></a>00763 
<a name="l00764"></a>00764         <span class="comment">// Default constructor.</span>
<a name="l00765"></a>00765         FSMContext(<span class="keyword">const</span> State&amp; state)
<a name="l00766"></a>00766         : _state(const_cast&lt;State *&gt;(&amp;state)),
<a name="l00767"></a>00767           _previous_state(NULL),
<a name="l00768"></a>00768           _state_stack(NULL),
<a name="l00769"></a>00769           _transition(NULL),
<a name="l00770"></a>00770 #ifdef SMC_USES_IOSTREAMS
<a name="l00771"></a>00771           _debug_flag(false),
<a name="l00772"></a>00772           _debug_stream(&amp;std::cerr)
<a name="l00773"></a>00773 #else
<a name="l00774"></a>00774           _debug_flag(false)
<a name="l00775"></a>00775 #endif <span class="comment">// SMC_USES_IOSTREAMS</span>
<a name="l00776"></a>00776         {};
<a name="l00777"></a>00777 
<a name="l00778"></a>00778     <span class="keyword">private</span>:
<a name="l00779"></a>00779 
<a name="l00780"></a>00780         <span class="comment">// I don&#39;t believe that it makes sense to copy a</span>
<a name="l00781"></a>00781         <span class="comment">// context. It may make sense to copy the application</span>
<a name="l00782"></a>00782         <span class="comment">// class but the new object is *not* in the same</span>
<a name="l00783"></a>00783         <span class="comment">// state as the old - the new object must start in</span>
<a name="l00784"></a>00784         <span class="comment">// the FSM&#39;s initial state. Therefore, the copy</span>
<a name="l00785"></a>00785         <span class="comment">// constructor is private in order to prevent it</span>
<a name="l00786"></a>00786         <span class="comment">// being used.</span>
<a name="l00787"></a>00787         FSMContext(<span class="keyword">const</span> FSMContext&amp;)
<a name="l00788"></a>00788         {};
<a name="l00789"></a>00789 
<a name="l00790"></a>00790     <span class="comment">//-----------------------------------------------------------</span>
<a name="l00791"></a>00791     <span class="comment">// Member data</span>
<a name="l00792"></a>00792     <span class="comment">//</span>
<a name="l00793"></a>00793     <span class="keyword">public</span>:
<a name="l00794"></a>00794     <span class="keyword">protected</span>:
<a name="l00795"></a>00795 
<a name="l00796"></a>00796         <span class="comment">// The current state of the finite state machine.</span>
<a name="l00797"></a>00797         State *_state;
<a name="l00798"></a>00798 
<a name="l00799"></a>00799         <span class="comment">// Remember which state a transition left.</span>
<a name="l00800"></a>00800         State *_previous_state;
<a name="l00801"></a>00801 
<a name="l00802"></a>00802         <span class="comment">// The stack of pushed states.</span>
<a name="l00803"></a>00803         StateEntry *_state_stack;
<a name="l00804"></a>00804 
<a name="l00805"></a>00805         <span class="comment">// The current transition *name*. Use for debugging</span>
<a name="l00806"></a>00806         <span class="comment">// purposes.</span>
<a name="l00807"></a>00807         <span class="keywordtype">char</span> *_transition;
<a name="l00808"></a>00808 
<a name="l00809"></a>00809     <span class="keyword">private</span>:
<a name="l00810"></a>00810 
<a name="l00811"></a>00811         <span class="comment">// When this flag is set to true, this class will print</span>
<a name="l00812"></a>00812         <span class="comment">// out debug messages.</span>
<a name="l00813"></a>00813         <span class="keywordtype">bool</span> _debug_flag;
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 <span class="comment">// Include the following only if C++ iostreams are being used.</span>
<a name="l00816"></a>00816 <span class="preprocessor">#ifdef SMC_USES_IOSTREAMS</span>
<a name="l00817"></a>00817 <span class="preprocessor"></span>        <span class="comment">// When FSM debugging is on, debug messages will be</span>
<a name="l00818"></a>00818         <span class="comment">// written to this output stream. This stream is set to</span>
<a name="l00819"></a>00819         <span class="comment">// standard error by default.</span>
<a name="l00820"></a>00820         std::ostream *_debug_stream;
<a name="l00821"></a>00821 <span class="preprocessor">#endif // SMC_USES_IOSTREAMS</span>
<a name="l00822"></a>00822 <span class="preprocessor"></span>
<a name="l00823"></a>00823     }; <span class="comment">// end of class FSMContext</span>
<a name="l00824"></a>00824 }
<a name="l00825"></a>00825 
<a name="l00826"></a>00826 <span class="comment">//</span>
<a name="l00827"></a>00827 <span class="comment">// CHANGE LOG</span>
<a name="l00828"></a>00828 <span class="comment">// $Log: statemap.h,v $</span>
<a name="l00829"></a>00829 <span class="comment">// Revision 1.17  2011/11/20 14:58:32  cwrapp</span>
<a name="l00830"></a>00830 <span class="comment">// Check in for SMC v. 6.1.0</span>
<a name="l00831"></a>00831 <span class="comment">//</span>
<a name="l00832"></a>00832 <span class="comment">// Revision 1.16  2010/09/11 19:09:38  fperrad</span>
<a name="l00833"></a>00833 <span class="comment">// remove \r from debug message</span>
<a name="l00834"></a>00834 <span class="comment">//</span>
<a name="l00835"></a>00835 <span class="comment">// Revision 1.15  2009/11/24 20:42:39  cwrapp</span>
<a name="l00836"></a>00836 <span class="comment">// v. 6.0.1 update</span>
<a name="l00837"></a>00837 <span class="comment">//</span>
<a name="l00838"></a>00838 <span class="comment">// Revision 1.14  2009/03/01 18:20:40  cwrapp</span>
<a name="l00839"></a>00839 <span class="comment">// Preliminary v. 6.0.0 commit.</span>
<a name="l00840"></a>00840 <span class="comment">//</span>
<a name="l00841"></a>00841 <span class="comment">// Revision 1.13  2008/05/20 18:31:12  cwrapp</span>
<a name="l00842"></a>00842 <span class="comment">// ----------------------------------------------------------------------</span>
<a name="l00843"></a>00843 <span class="comment">//</span>
<a name="l00844"></a>00844 <span class="comment">// Committing release 5.1.0.</span>
<a name="l00845"></a>00845 <span class="comment">//</span>
<a name="l00846"></a>00846 <span class="comment">// Modified Files:</span>
<a name="l00847"></a>00847 <span class="comment">//      Makefile README.txt smc.mk tar_list.txt bin/Smc.jar</span>
<a name="l00848"></a>00848 <span class="comment">//      examples/Ant/EX1/build.xml examples/Ant/EX2/build.xml</span>
<a name="l00849"></a>00849 <span class="comment">//      examples/Ant/EX3/build.xml examples/Ant/EX4/build.xml</span>
<a name="l00850"></a>00850 <span class="comment">//      examples/Ant/EX5/build.xml examples/Ant/EX6/build.xml</span>
<a name="l00851"></a>00851 <span class="comment">//      examples/Ant/EX7/build.xml examples/Ant/EX7/src/Telephone.java</span>
<a name="l00852"></a>00852 <span class="comment">//      examples/Java/EX1/Makefile examples/Java/EX4/Makefile</span>
<a name="l00853"></a>00853 <span class="comment">//      examples/Java/EX5/Makefile examples/Java/EX6/Makefile</span>
<a name="l00854"></a>00854 <span class="comment">//      examples/Java/EX7/Makefile examples/Ruby/EX1/Makefile</span>
<a name="l00855"></a>00855 <span class="comment">//      lib/statemap.jar lib/C++/statemap.h lib/Java/Makefile</span>
<a name="l00856"></a>00856 <span class="comment">//      lib/Php/statemap.php lib/Scala/Makefile</span>
<a name="l00857"></a>00857 <span class="comment">//      lib/Scala/statemap.scala net/sf/smc/CODE_README.txt</span>
<a name="l00858"></a>00858 <span class="comment">//      net/sf/smc/README.txt net/sf/smc/Smc.java</span>
<a name="l00859"></a>00859 <span class="comment">// ----------------------------------------------------------------------</span>
<a name="l00860"></a>00860 <span class="comment">//</span>
<a name="l00861"></a>00861 <span class="comment">// Revision 1.12  2007/12/28 12:34:40  cwrapp</span>
<a name="l00862"></a>00862 <span class="comment">// Version 5.0.1 check-in.</span>
<a name="l00863"></a>00863 <span class="comment">//</span>
<a name="l00864"></a>00864 <span class="comment">// Revision 1.11  2007/08/05 12:58:54  cwrapp</span>
<a name="l00865"></a>00865 <span class="comment">// Version 5.0.1 check-in. See net/sf/smc/CODE_README.txt for more information.</span>
<a name="l00866"></a>00866 <span class="comment">//</span>
<a name="l00867"></a>00867 <span class="comment">// Revision 1.10  2007/01/15 00:23:50  cwrapp</span>
<a name="l00868"></a>00868 <span class="comment">// Release 4.4.0 initial commit.</span>
<a name="l00869"></a>00869 <span class="comment">//</span>
<a name="l00870"></a>00870 <span class="comment">// Revision 1.9  2006/07/11 18:28:22  cwrapp</span>
<a name="l00871"></a>00871 <span class="comment">// Move SmcException::copyString() to a package-wide routine.</span>
<a name="l00872"></a>00872 <span class="comment">//</span>
<a name="l00873"></a>00873 <span class="comment">// Revision 1.8  2006/04/22 12:45:24  cwrapp</span>
<a name="l00874"></a>00874 <span class="comment">// Version 4.3.1</span>
<a name="l00875"></a>00875 <span class="comment">//</span>
<a name="l00876"></a>00876 <span class="comment">// Revision 1.7  2005/06/08 11:09:14  cwrapp</span>
<a name="l00877"></a>00877 <span class="comment">// + Updated Python code generator to place &quot;pass&quot; in methods with empty</span>
<a name="l00878"></a>00878 <span class="comment">//   bodies.</span>
<a name="l00879"></a>00879 <span class="comment">// + Corrected FSM errors in Python example 7.</span>
<a name="l00880"></a>00880 <span class="comment">// + Removed unnecessary includes from C++ examples.</span>
<a name="l00881"></a>00881 <span class="comment">// + Corrected errors in top-level makefile&#39;s distribution build.</span>
<a name="l00882"></a>00882 <span class="comment">//</span>
<a name="l00883"></a>00883 <span class="comment">// Revision 1.6  2005/05/28 18:44:13  cwrapp</span>
<a name="l00884"></a>00884 <span class="comment">// Updated C++, Java and Tcl libraries, added CSharp, Python and VB.</span>
<a name="l00885"></a>00885 <span class="comment">//</span>
<a name="l00886"></a>00886 <span class="comment">// Revision 1.2  2005/02/21 19:01:42  charlesr</span>
<a name="l00887"></a>00887 <span class="comment">// Changed State::_id to State::_stateId because of Object-C++</span>
<a name="l00888"></a>00888 <span class="comment">// reserved word conflict.</span>
<a name="l00889"></a>00889 <span class="comment">//</span>
<a name="l00890"></a>00890 <span class="comment">// Revision 1.1  2004/05/31 13:44:41  charlesr</span>
<a name="l00891"></a>00891 <span class="comment">// Added support for non-iostreams output.</span>
<a name="l00892"></a>00892 <span class="comment">//</span>
<a name="l00893"></a>00893 <span class="comment">// Revision 1.0  2003/12/14 20:37:49  charlesr</span>
<a name="l00894"></a>00894 <span class="comment">// Initial revision</span>
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 <span class="preprocessor">#endif</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Mon Sep 8 17:45:55 2014 for OMNEST Simulation Library by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
