<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Tictoc Tutorial: Txc16 Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="annotated.html"><span>Class&nbsp;List</span></a></li>
      <li><a href="hierarchy.html"><span>Class&nbsp;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&nbsp;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Txc16 Class Reference</h1><!-- doxytag: class="Txc16" --><!-- doxytag: inherits="cSimpleModule" --><div class="dynheader">
Inheritance diagram for Txc16:</div>
<div class="dynsection">
 <div class="center">
  <img src="classTxc16.png" usemap="#Txc16_map" alt=""/>
  <map id="Txc16_map" name="Txc16_map">
<area doxygen="opptags.xml:../api//" href="../api//classcSimpleModule.html" alt="cSimpleModule" shape="rect" coords="90,392,261,416"/>
<area doxygen="opptags.xml:../api//" href="../api//classcModule.html" alt="cModule" shape="rect" coords="90,336,261,360"/>
<area doxygen="opptags.xml:../api//" href="../api//classcComponent.html" alt="cComponent" shape="rect" coords="90,280,261,304"/>
<area doxygen="opptags.xml:../api//" href="../api//classcDefaultList.html" alt="cDefaultList" shape="rect" coords="90,224,261,248"/>
<area doxygen="opptags.xml:../api//" href="../api//classcNoncopyableOwnedObject.html" alt="cNoncopyableOwnedObject" shape="rect" coords="90,168,261,192"/>
<area doxygen="opptags.xml:../api//" href="../api//classcOwnedObject.html" alt="cOwnedObject" shape="rect" coords="0,112,171,136"/>
<area doxygen="opptags.xml:../api//" href="../api//classnoncopyable.html" alt="noncopyable" shape="rect" coords="181,112,352,136"/>
<area doxygen="opptags.xml:../api//" href="../api//classcNamedObject.html" alt="cNamedObject" shape="rect" coords="0,56,171,80"/>
<area doxygen="opptags.xml:../api//" href="../api//classcObject.html" alt="cObject" shape="rect" coords="0,0,171,24"/>
</map>
 </div>
</div>

<p><a href="classTxc16-members.html">List of all members.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual TicTocMsg16 *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTxc16.html#aced632d9c8d08f7920b491398517d51e">generateMessage</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTxc16.html#aabd67da572753feaa1e43fa9c45057f3">forwardMessage</a> (TicTocMsg16 *msg)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTxc16.html#a79a503b3ea944bda9376e0467a418767">initialize</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTxc16.html#a025844a47db5345929a4db351953ca87">handleMessage</a> (<a class="elRef" doxygen="opptags.xml:../api//" href="../api//classcMessage.html">cMessage</a> *msg)</td></tr>
<tr><td colspan="2"><h2>Private Attributes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">simsignal_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="classTxc16.html#a8794039dc73e44779d67a9bedec79e80">arrivalSignal</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>The main problem with the previous step is that we must modify the model's code if we want to change what statistics are gathered. Statistic calculation is woven deeply into the model code which is hard to modify and understand.</p>
<p>OMNeT++ 4.1 provides a different mechanism called 'signals' that we can use to gather statistics. First we have to identify the events where the state of the model changes. We can emit signals at these points that carry the value of chosen state variables. This way the C++ code only emits signals, but how those signals are processed are determined only by the listeners that are attached to them.</p>
<p>The signals the model emits and the listeners that process them can be defined in the NED file using the 'signal' and 'statistic' property.</p>
<p>We will gather the same statistics as in the previous step, but notice that we will not need any private member variables to calculate these values. We will use only a single signal that is emitted when a message arrives and carries the hopcount in the message. </p>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="aabd67da572753feaa1e43fa9c45057f3"></a><!-- doxytag: member="Txc16::forwardMessage" ref="aabd67da572753feaa1e43fa9c45057f3" args="(TicTocMsg16 *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Txc16::forwardMessage </td>
          <td>(</td>
          <td class="paramtype">TicTocMsg16 *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="txc16_8cc_source.html#l00061">handleMessage()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00109"></a>00109 {
<a name="l00110"></a>00110     <span class="comment">// Increment hop count.</span>
<a name="l00111"></a>00111     msg-&gt;setHopCount(msg-&gt;getHopCount()+1);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="comment">// Same routing as before: random gate.</span>
<a name="l00114"></a>00114     <span class="keywordtype">int</span> n = <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcModule.html#ac63b0b9c805c5f335d274195f2fdb28c">gateSize</a>(<span class="stringliteral">&quot;gate&quot;</span>);
<a name="l00115"></a>00115     <span class="keywordtype">int</span> k = <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//group__RandomNumbersDiscr.html#gaee8ce6ae7e43b06e968a023f25c91b4f">intuniform</a>(0,n-1);
<a name="l00116"></a>00116 
<a name="l00117"></a>00117     <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//group__Envir.html#ga650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Forwarding message &quot;</span> &lt;&lt; msg &lt;&lt; <span class="stringliteral">&quot; on gate[&quot;</span> &lt;&lt; k &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;
<a name="l00118"></a>00118     <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcSimpleModule.html#a94590ba6481116f29f4c43d00733deea">send</a>(msg, <span class="stringliteral">&quot;gate$o&quot;</span>, k);
<a name="l00119"></a>00119 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="aced632d9c8d08f7920b491398517d51e"></a><!-- doxytag: member="Txc16::generateMessage" ref="aced632d9c8d08f7920b491398517d51e" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">TicTocMsg16 * Txc16::generateMessage </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="txc16_8cc_source.html#l00061">handleMessage()</a>, and <a class="el" href="txc16_8cc_source.html#l00049">initialize()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00091"></a>00091 {
<a name="l00092"></a>00092     <span class="comment">// Produce source and destination addresses.</span>
<a name="l00093"></a>00093     <span class="keywordtype">int</span> src = <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcModule.html#a604e26394d77938a860eeb4452f25606">getIndex</a>();
<a name="l00094"></a>00094     <span class="keywordtype">int</span> n = <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcModule.html#ad08955e71fd144469a04f0ea26c22766">size</a>();
<a name="l00095"></a>00095     <span class="keywordtype">int</span> dest = <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//group__RandomNumbersDiscr.html#gaee8ce6ae7e43b06e968a023f25c91b4f">intuniform</a>(0,n-2);
<a name="l00096"></a>00096     <span class="keywordflow">if</span> (dest&gt;=src) dest++;
<a name="l00097"></a>00097 
<a name="l00098"></a>00098     <span class="keywordtype">char</span> msgname[20];
<a name="l00099"></a>00099     sprintf(msgname, <span class="stringliteral">&quot;tic-%d-to-%d&quot;</span>, src, dest);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101     <span class="comment">// Create message object and set source and destination field.</span>
<a name="l00102"></a>00102     TicTocMsg16 *msg = <span class="keyword">new</span> TicTocMsg16(msgname);
<a name="l00103"></a>00103     msg-&gt;setSource(src);
<a name="l00104"></a>00104     msg-&gt;setDestination(dest);
<a name="l00105"></a>00105     <span class="keywordflow">return</span> msg;
<a name="l00106"></a>00106 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a025844a47db5345929a4db351953ca87"></a><!-- doxytag: member="Txc16::handleMessage" ref="a025844a47db5345929a4db351953ca87" args="(cMessage *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Txc16::handleMessage </td>
          <td>(</td>
          <td class="paramtype"><a class="elRef" doxygen="opptags.xml:../api//" href="../api//classcMessage.html">cMessage</a> *&nbsp;</td>
          <td class="paramname"> <em>msg</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="elRef" doxygen="opptags.xml:../api//" href="../api//classcSimpleModule.html#ac1a639fd9b931de297477fca26341650">cSimpleModule</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00062"></a>00062 {
<a name="l00063"></a>00063     TicTocMsg16 *ttmsg = <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//group__Functions.html#gac05a322b9912da77f8b797eeab7805f4">check_and_cast</a>&lt;TicTocMsg16 *&gt;(msg);
<a name="l00064"></a>00064 
<a name="l00065"></a>00065     <span class="keywordflow">if</span> (ttmsg-&gt;getDestination()==<a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcModule.html#a604e26394d77938a860eeb4452f25606">getIndex</a>())
<a name="l00066"></a>00066     {
<a name="l00067"></a>00067         <span class="comment">// Message arrived</span>
<a name="l00068"></a>00068         <span class="keywordtype">int</span> hopcount = ttmsg-&gt;getHopCount();
<a name="l00069"></a>00069         <span class="comment">// send a signal</span>
<a name="l00070"></a>00070         <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcComponent.html#a29022c0570003b4722ebc58df66967eb">emit</a>(<a class="code" href="classTxc16.html#a8794039dc73e44779d67a9bedec79e80">arrivalSignal</a>, hopcount);
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//group__Envir.html#ga650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Message &quot;</span> &lt;&lt; ttmsg &lt;&lt; <span class="stringliteral">&quot; arrived after &quot;</span> &lt;&lt; hopcount &lt;&lt; <span class="stringliteral">&quot; hops.\n&quot;</span>;
<a name="l00073"></a>00073         <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcComponent.html#a8b1160aa2bb4f94af176df5da5075afb">bubble</a>(<span class="stringliteral">&quot;ARRIVED, starting new one!&quot;</span>);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <span class="keyword">delete</span> ttmsg;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077         <span class="comment">// Generate another one.</span>
<a name="l00078"></a>00078         <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//group__Envir.html#ga650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; <span class="stringliteral">&quot;Generating another message: &quot;</span>;
<a name="l00079"></a>00079         TicTocMsg16 *newmsg = <a class="code" href="classTxc16.html#aced632d9c8d08f7920b491398517d51e">generateMessage</a>();
<a name="l00080"></a>00080         <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//group__Envir.html#ga650ef3eff8a2900bef69dae29c05d2dd">EV</a> &lt;&lt; newmsg &lt;&lt; endl;
<a name="l00081"></a>00081         <a class="code" href="classTxc16.html#aabd67da572753feaa1e43fa9c45057f3">forwardMessage</a>(newmsg);
<a name="l00082"></a>00082     }
<a name="l00083"></a>00083     <span class="keywordflow">else</span>
<a name="l00084"></a>00084     {
<a name="l00085"></a>00085         <span class="comment">// We need to forward the message.</span>
<a name="l00086"></a>00086         <a class="code" href="classTxc16.html#aabd67da572753feaa1e43fa9c45057f3">forwardMessage</a>(ttmsg);
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a79a503b3ea944bda9376e0467a418767"></a><!-- doxytag: member="Txc16::initialize" ref="a79a503b3ea944bda9376e0467a418767" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void Txc16::initialize </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reimplemented from <a class="elRef" doxygen="opptags.xml:../api//" href="../api//classcComponent.html#a0532af98c1157359b60adcb09f3fefca">cComponent</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00050"></a>00050 {
<a name="l00051"></a>00051     <a class="code" href="classTxc16.html#a8794039dc73e44779d67a9bedec79e80">arrivalSignal</a> = <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcComponent.html#aeaa2a3ca2cb5f2c798ff0bea82f38a91">registerSignal</a>(<span class="stringliteral">&quot;arrival&quot;</span>);
<a name="l00052"></a>00052     <span class="comment">// Module 0 sends the first message</span>
<a name="l00053"></a>00053     <span class="keywordflow">if</span> (<a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcModule.html#a604e26394d77938a860eeb4452f25606">getIndex</a>()==0)
<a name="l00054"></a>00054     {
<a name="l00055"></a>00055         <span class="comment">// Boot the process scheduling the initial message as a self-message.</span>
<a name="l00056"></a>00056         TicTocMsg16 *msg = <a class="code" href="classTxc16.html#aced632d9c8d08f7920b491398517d51e">generateMessage</a>();
<a name="l00057"></a>00057         <a class="codeRef" doxygen="opptags.xml:../api//" href="../api//classcSimpleModule.html#a29a64f1f0c560ac75494940d5c7a048d">scheduleAt</a>(0.0, msg);
<a name="l00058"></a>00058     }
<a name="l00059"></a>00059 }
</pre></div></p>

</div>
</div>
<hr/><h2>Member Data Documentation</h2>
<a class="anchor" id="a8794039dc73e44779d67a9bedec79e80"></a><!-- doxytag: member="Txc16::arrivalSignal" ref="a8794039dc73e44779d67a9bedec79e80" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">simsignal_t <a class="el" href="classTxc16.html#a8794039dc73e44779d67a9bedec79e80">Txc16::arrivalSignal</a><code> [private]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Referenced by <a class="el" href="txc16_8cc_source.html#l00061">handleMessage()</a>, and <a class="el" href="txc16_8cc_source.html#l00049">initialize()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li><a class="el" href="txc16_8cc.html">txc16.cc</a></li>
</ul>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Dec 2 11:16:33 2014 for Tictoc Tutorial by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
